const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-buUMaeMm.js","assets/index-C-NWtsoG.js","assets/index-BFJltGNr.js","assets/index-BK-I7xHM.css"])))=>i.map(i=>d[i]);
import{y as d,_ as s,w as g,K as u,a as l}from"./index-BFJltGNr.js";import{RecoveryShareManagement as o,UserStatus as a}from"./index-buUMaeMm.js";import{n as p}from"./normalizeChainId-1fb9aedf.browser.esm-Dulsj_Qd.js";import"./index-C-NWtsoG.js";class A extends d{constructor(e){super(),s(this,"id",g.paper),s(this,"name","Paper Wallet"),s(this,"ready",!0),s(this,"user",null),s(this,"onAccountsChanged",async t=>{t.length===0?await this.onDisconnect():this.emit("change",{account:u(t[0])})}),s(this,"onChainChanged",t=>{const i=p(t),n=this.options.chains.findIndex(r=>r.chainId===i)===-1;this.emit("change",{chain:{id:i,unsupported:n}})}),s(this,"onDisconnect",async()=>{this.emit("disconnect")}),this.options=e}getPaperSDK(){return this.paper||(this.paper=new Promise(async(e,t)=>{const i=this.options.advancedOptions?.recoveryShareManagement;try{const{PaperEmbeddedWalletSdk:n}=await l(async()=>{const{PaperEmbeddedWalletSdk:c}=await import("./index-buUMaeMm.js");return{PaperEmbeddedWalletSdk:c}},__vite__mapDeps([0,1,2,3])),r={AWS_MANAGED:o.AWS_MANAGED,USER_MANAGED:o.USER_MANAGED},h=i?r[i]:void 0;e(new n({advancedOptions:{recoveryShareManagement:h},clientId:this.options.clientId,chain:"Ethereum",styles:this.options.styles,onAuthSuccess:this.options.onAuthSuccess}))}catch(n){t(n)}})),this.paper}async connect(e){const t=await this.getPaperSDK();if(!t)throw new Error("Paper SDK not initialized");const i=await t.getUser();switch(i.status){case a.LOGGED_OUT:{let n;if(e?.googleLogin){const r=e.googleLogin;n=await t.auth.loginWithGoogle(typeof r=="object"?r:void 0)}else e?.email&&e?.otp?n=await t.auth.verifyPaperEmailLoginOtp({email:e.email,otp:e.otp,recoveryCode:e.recoveryCode}):e?.email?n=await t.auth.loginWithPaperEmailOtp({email:e.email}):n=await t.auth.loginWithPaperModal();this.user=n.user;break}case a.LOGGED_IN_WALLET_INITIALIZED:{typeof e?.googleLogin=="object"&&e.googleLogin.closeOpenedWindow&&e.googleLogin.openedWindow&&e.googleLogin.closeOpenedWindow(e.googleLogin.openedWindow),this.user=i;break}}if(!this.user)throw new Error("Error connecting User");return e?.chainId&&this.switchChain(e.chainId),this.setupListeners(),this.getAddress()}async disconnect(){await(await this.paper)?.auth.logout(),this._signer=void 0,this.user=null}async getAddress(){return(await this.getSigner()).getAddress()}async isConnected(){try{return!!await this.getAddress()}catch{return!1}}async getProvider(){const e=await this.getSigner();if(!e.provider)throw new Error("Provider not found");return e.provider}async getSigner(){if(this._signer)return this._signer;if(!this.user){const i=await(await this.getPaperSDK()).getUser();switch(i.status){case a.LOGGED_IN_WALLET_INITIALIZED:{this.user=i;break}}}const e=await this.user?.wallet.getEthersJsSigner({rpcEndpoint:this.options.chain.rpc[0]||""});if(!e)throw new Error("Signer not found");return this._signer=e,e}async isAuthorized(){return!1}async switchChain(e){const t=this.options.chains.find(i=>i.chainId===e);if(!t)throw new Error("Chain not configured");await this.user?.wallet.setChain({chain:"Ethereum"}),this._signer=await this.user?.wallet.getEthersJsSigner({rpcEndpoint:t.rpc[0]||""}),this.emit("change",{chain:{id:e,unsupported:!1}})}async setupListeners(){const e=await this.getProvider();e.on&&(e.on("accountsChanged",this.onAccountsChanged),e.on("chainChanged",this.onChainChanged),e.on("disconnect",this.onDisconnect))}updateChains(e){this.options.chains=e}async getEmail(){if(await this.getProvider(),!this.user)throw new Error("No user found, Paper Wallet is not connected");return this.user.authDetails.email}}export{A as PaperWalletConnector};
